<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>E-commerce</title>
    <link rel="icon" href="assets/image/logo.png" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet"
      integrity="sha384-T3c6CoIi6uLrA9TneNEoa7RxnatzjcDSCmG1MXxSR1GAsXEV/Dwwykc2MPK8M2HN"
      crossorigin="anonymous"
    />
    <link rel="stylesheet" href="assets/css/style.css" type="text/css" />
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  </head>
  <body>
    <nav class="navbar navbar-expand-lg bg-body-tertiary">
      <div class="container-fluid">
        <a class="navbar-brand" href="#">
          <img src="assets/image/logo.png" alt="logo" />
        </a>
        <button
          class="navbar-toggler"
          type="button"
          data-bs-toggle="collapse"
          data-bs-target="#navbarSupportedContent"
          aria-controls="navbarSupportedContent"
          aria-expanded="false"
          aria-label="Toggle navigation"
        >
          <span class="navbar-toggler-icon"></span>
        </button>
        <div class="collapse navbar-collapse" id="navbarSupportedContent">
          <ul class="navbar-nav me-auto mb-2 mb-lg-0">
            <li class="nav-item dropdown">
              <a
                class="nav-link dropdown-toggle"
                href="#"
                role="button"
                data-bs-toggle="dropdown"
                aria-expanded="false"
              >
                SHOP
              </a>
              <ul class="dropdown-menu">
                <li><a class="dropdown-item" href="#">Action</a></li>
                <li><a class="dropdown-item" href="#">Another action</a></li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <a class="dropdown-item" href="#">Something else here</a>
                </li>
              </ul>
            </li>
            <li class="nav-item">
              <a class="nav-link" aria-disabled="true">PAYMENT CONFIRMATION</a>
            </li>
            <li class="nav-item">
              <a class="nav-link" aria-disabled="true">TRACK YOUR ORDER</a>
            </li>
          </ul>
          <form class="d-flex" role="search">
            <!-- <input
              class="form-control me-2"
              type="search"
              placeholder="Search"
              aria-label="Search"
            /> -->
            <button class="btn-navbar" type="submit">
              <iconify-icon
                icon="fluent:search-20-regular"
                width="30"
              ></iconify-icon>
            </button>
          </form>
          <button class="btn-navbar">Login</button>
          <button class="btn-navbar" id="hideSidebarButton">
            Cart
            <iconify-icon icon="fe:cart"></iconify-icon>
          </button>
        </div>
      </div>
    </nav>
    <div id="tes"></div>
    <div id="carouselExampleIndicators" class="carousel slide">
      <div class="carousel-indicators">
        <button
          type="button"
          data-bs-target="#carouselExampleIndicators"
          data-bs-slide-to="0"
          class="active"
          aria-current="true"
          aria-label="Slide 1"
        ></button>
        <button
          type="button"
          data-bs-target="#carouselExampleIndicators"
          data-bs-slide-to="1"
          aria-label="Slide 2"
        ></button>
        <button
          type="button"
          data-bs-target="#carouselExampleIndicators"
          data-bs-slide-to="2"
          aria-label="Slide 3"
        ></button>
      </div>
      <div class="carousel-inner">
        <div class="carousel-item active">
          <img
            src="assets/image/carousel.png"
            class="d-block w-100"
            alt="..."
          />
        </div>
        <div class="carousel-item">
          <img
            src="assets/image/carousel.png"
            class="d-block w-100"
            alt="..."
          />
        </div>
        <div class="carousel-item">
          <img
            src="assets/image/carousel.png"
            class="d-block w-100"
            alt="..."
          />
        </div>
      </div>
      <button
        class="carousel-control-prev"
        type="button"
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide="prev"
      >
        <span class="carousel-control-prev-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Previous</span>
      </button>
      <button
        class="carousel-control-next"
        type="button"
        data-bs-target="#carouselExampleIndicators"
        data-bs-slide="next"
      >
        <span class="carousel-control-next-icon" aria-hidden="true"></span>
        <span class="visually-hidden">Next</span>
      </button>
    </div>
    <div class="d-flex justify-content-around mt-4">
      <div class="card-adv-1">
        <h3>T-SHIRT COLLECTION</h3>
      </div>
      <div class="card-adv-2">
        <h3>T-SHIRT COLLECTION</h3>
      </div>
      <div class="card-adv-3">
        <h3>T-SHIRT COLLECTION</h3>
      </div>
    </div>
    <div class="d-flex justify-content-center">
      <div class="text-center container" style="margin: 50px 0px">
        <hr style="float: left; width: 40%; border-top: 1px solid #000" />
        <h3 class="text-1" style="display: inline-block">FEATURED PRODUCTS</h3>
        <hr style="float: right; width: 40%; border-top: 1px solid #000"" />
      </div>
    </div>
    <div
      class="d-flex flex-wrap justify-content-center gap-4 mt-4 container"
      id="card-container"
    ></div>
    <div class="loader">loading</div>
    <footer class="d-flex justify-content-around mt-5">
      <div>
        <h3>Help</h3>
        <div>
          <p>text</p>
          <p>text</p>
          <p>text</p>
          <p>text</p>
          <p>text</p>
        </div>
      </div>
      <div>
        <h3>About Us</h3>
        <div>
          <p>text</p>
          <p>text</p>
          <p>text</p>
          <p>text</p>
          <p>text</p>
        </div>
      </div>
      <div>
        <h3>Contact Us</h3>
        <div>
          <p>text</p>
          <p>text</p>
          <p>text</p>
          <p>text</p>
          <p>text</p>
        </div>
      </div>
    </footer>

    <script
      src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"
      integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL"
      crossorigin="anonymous"
    ></script>
    <script src="https://code.iconify.design/iconify-icon/1.0.7/iconify-icon.min.js"></script>
  </body>
</html>
<script>
  var currentPage = 0;
  var loading = false;
  var allDataLoaded = false; // Tambahkan variabel ini untuk menandai semua data sudah dimuat

  // Fungsi untuk mengonsumsi API dan memasukkan hasilnya ke dalam card
  function populateCard(data) {
    var cardTemplate = `
        <div class="card" style="width: 18rem">
            <img src="${data.photo}" class="card-img-top" alt="..." />
            <div class="card-body">
            <h5 class="card-title">${data.name}</h5>
            <p class="card-text">Rp.${data.price},-</p>
            <div class="d-flex justify-content-center">
                <a href="detail_1.html?id=${data.id}" class="btn-detail">
                lihat detail
                </a>
            </div>
            </div>
        </div>
      `;

    $("#card-container").append(cardTemplate);
  }

  // Fungsi untuk menampilkan pesan "Data sudah muncul semua"
  function showAllDataLoaded() {
    $("#card-container").append("<br><p>Data sudah muncul semua</p>");
  }

  // Fungsi untuk memuat data dari halaman berikutnya
  function loadNextPage() {
    if (loading || allDataLoaded) return;
    loading = true;

    // Menampilkan elemen loading saat memuat data
    $(".loader").show();

    // Menggunakan jQuery untuk melakukan permintaan GET ke halaman berikutnya
    $.get(
      "https://demo.sistemtoko.com/public/demo/product?page=" +
        (currentPage + 1),
      function (response) {
        // Memproses data API dan memanggil fungsi populateCard untuk setiap hasil
        console.log(response);
        response.aaData.forEach(function (data) {
          populateCard(data);
        });

        currentPage++;
        loading = false;

        // Menyembunyikan elemen loading setelah memuat data
        $(".loader").hide();

        // Mengecek apakah masih ada data selanjutnya
        if (response.aaData.length === 0) {
          allDataLoaded = true;
          showAllDataLoaded();
        }
      }
    );
  }

  // Memantau posisi scroll
  $(window).scroll(function () {
    // Jika pengguna mendekati akhir halaman, muat halaman berikutnya
    if (
      $(window).scrollTop() >=
      $(document).height() - $(window).height() - 300
    ) {
      loadNextPage();
    }
  });

  // Memuat halaman pertama saat halaman dimuat
  loadNextPage();

  $(document).ready(function () {
    $.ajaxSetup({
      headers: { "X-Requested-With": "XMLHttpRequest" },
    });

    $.get("https://demo.sistemtoko.com/api-view/cart", function (data) {
      // console.log(data);
      $("#tes").append(data);
    });

    $("#button").click(function () {
      var selectedOption = $("#select-variant option:selected");
      product_id = selectedOption.val();
      $.get(
        "https://sistemtoko.com/public/demo/single/" + product_id,
        function (productData) {
          console.log(productData);
          product_id = productData.product_id;
          product_name = productData.product_name;
          product_img = `https://sistemtoko.com/img/user/demo/product/${productData.product_img}`;
          product_price = productData.product_price;
          product_qty = 0;
          product_weight = productData.product_weight;
          product_stock = productData.product_qty_stock;
          varian = productData.varian_keyword_value;
          // Memanggil fungsi addCart dengan data produk yang dipilih
          addCart(
            product_id,
            product_name + "-" + varian,
            product_img,
            product_price,
            product_weight
          );
        }
      );
    });
  });

  $(document).ready(function () {
    $("#hideSidebarButton").click(function () {
      console.log("click");
      if ($("#cart-wrapper").hasClass("toggled")) {
        // Sidebar sedang disembunyikan, jadi tampilkan
        $("#cart-wrapper").removeClass("toggled");
      } else {
        // Sidebar sedang ditampilkan, jadi sembunyikan
        $("#cart-wrapper").addClass("toggled");
      }
    });
  });
</script>
